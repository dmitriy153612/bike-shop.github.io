import{d as S,o as u,c as v,a as d,n as le,_ as I,u as ae,b as j,e as se,r as h,f as oe,g,w as k,t as V,h as $,i as w,B as J,F as L,j as T,k as re,l as P,m as ie,C as ne,p as ce,q as ue,s as de,v as O,x as D,y as E,z as x,A as N,D as X,E as K,G as pe,H as _e,I as U,J as fe,K as ge,L as H,M as ve,N as Y,O as me,T as W,P as R,Q as be}from"./index-DtM1jsSZ.js";import{A as ye}from"./AppTitle-CV5mu-GZ.js";import{A as he}from"./AppSizePicker-B7txxGWH.js";import{A as Ce}from"./AppPrice-BY-B-5cy.js";import{A as Pe}from"./AppCheckbox-Bs3yFKsy.js";const ke={class:"color-box"},Ae=["aria-label"],Se=S({__name:"ColorIndicator",props:{colorCode:{type:String,required:!0},colorName:{type:String,required:!0}},setup(e){return(p,c)=>(u(),v("div",ke,[c[0]||(c[0]=d("span",{class:"color-box__title"},"Цвет:",-1)),d("span",{class:"color-box__color","aria-label":e.colorName,style:le({"background-color":e.colorCode})},null,12,Ae)]))}}),Ie=I(Se,[["__scopeId","data-v-71fd2808"]]),$e={class:"card"},xe={key:0,class:"card__discount"},qe={class:"card__discount-percent"},ze=["src","alt"],Ve={class:"card__title"},Fe={class:"card__row"},we=S({__name:"CatalogCard",props:{id:{type:String,required:!0},discount:{type:Number,default:null},title:{type:String,required:!0},sizes:{type:Array,required:!0},color:{type:Object,required:!0},price:{type:Number,required:!0},oldPrice:{type:Number,default:null},img:{type:String,required:!0}},setup(e){const p=e,c=ae(),o=j(),i=se(),t=h(p.sizes[0]?p.sizes[0]._id:""),_=h(!1);async function a(l){if(!i.token){o.openLoginModal(!0,l);return}_.value=!0,await c.fetchAddToCart({productId:p.id,sizeId:t.value,amount:1}),_.value=!1}return(l,f)=>{const C=oe("router-link");return u(),v("div",$e,[g(C,{class:"card__img-link",tabindex:"-1",to:{name:"product",params:{id:e.id},query:{sizeId:t.value}}},{default:k(()=>[e.discount?(u(),v("div",xe,[f[1]||(f[1]=d("svg",{class:"card__discount-svg"},[d("use",{"xlink:href":"#discount"})],-1)),d("span",qe,V(e.discount)+"%",1)])):$("",!0),d("img",{class:"card__img",loading:"lazy",src:e.img,alt:e.title},null,8,ze)]),_:1},8,["to"]),d("h2",Ve,[g(C,{class:"card__link",to:{name:"product",params:{id:e.id},query:{sizeId:t.value}}},{default:k(()=>[w(V(e.title),1)]),_:1},8,["to"])]),d("div",Fe,[g(he,{modelValue:t.value,"onUpdate:modelValue":f[0]||(f[0]=b=>t.value=b),sizes:e.sizes},null,8,["modelValue","sizes"]),g(Ie,{"color-code":e.color.code,"color-name":e.color.name},null,8,["color-code","color-name"])]),g(Ce,{class:"card__price-box",price:e.price,"old-price":e.oldPrice},null,8,["price","old-price"]),g(J,{class:"card__btn","btn-name":"В корзину","show-spinner":_.value,onClick:a},{default:k(()=>f[2]||(f[2]=[d("svg",null,[d("use",{"xlink:href":"#cart"})],-1)])),_:1},8,["show-spinner"])])}}}),Ee=I(we,[["__scopeId","data-v-83d82446"]]),Le={class:"catalog"},Te=S({__name:"CatalogList",props:{catalog:{type:Array,required:!0}},setup(e){return(p,c)=>(u(),v("ul",Le,[(u(!0),v(L,null,T(e.catalog,o=>(u(),v("li",{key:o._id,class:"catalog__item"},[g(Ee,{id:o._id,discount:o.discount,title:o.title,sizes:o.sizes,color:o.color,price:o.price,"old-price":o.oldPrice,img:o.pictures[0]},null,8,["id","discount","title","sizes","color","price","old-price","img"])]))),128))]))}}),Oe=I(Te,[["__scopeId","data-v-6be2cf5d"]]),Be={class:"filter-fieldset"},Ne={class:"filter-fieldset__legend"},We=S({__name:"CatalogFilterFieldset",props:{legend:{type:String,required:!0}},setup(e){return(p,c)=>(u(),v("fieldset",Be,[d("legend",Ne,V(e.legend),1),re(p.$slots,"default",{},void 0,!0)]))}}),G=I(We,[["__scopeId","data-v-3738601b"]]),Re={class:"filter-checkboxes"},Ue=S({__name:"CheckboxList",props:{properties:{type:Array,required:!0},modelValue:{type:Array,required:!0}},emits:["update:modelValue"],setup(e,{emit:p}){const c=p,o=e,i=P({get:()=>o.modelValue,set:t=>c("update:modelValue",t)});return(t,_)=>(u(),v("ul",Re,[(u(!0),v(L,null,T(e.properties,a=>(u(),v("li",{key:a._id,class:"filter-checkboxes__item"},[g(Pe,{modelValue:i.value,"onUpdate:modelValue":_[0]||(_[0]=l=>i.value=l),value:a._id,name:a.name},null,8,["modelValue","value","name"])]))),128))]))}}),M=I(Ue,[["__scopeId","data-v-033eb577"]]),Z=ie("catalogStore",()=>{const e=j(),p=h([]),c=h(null),o=h(!1),i=h(null);async function t(_){const a={..._,limit:ne};try{o.value=!0,e.showSpinner(!0);const l=await ce.get(`${ue}${de}`,{params:a});p.value=l.data.catalog,c.value=l.data.config}catch(l){console.error(l),i.value=l}finally{o.value=!1,e.showSpinner(!1)}}return{catalog:p,config:c,isLoading:o,error:i,fetchCatalog:t}});function Q(){const e=O(),p=Z(),c=P(()=>p.config&&p.config.totalPages?p.config.totalPages:0),o=P(()=>({colorId:a(e.query.colorId),sizeId:a(e.query.sizeId),brandId:a(e.query.brandId),minPrice:typeof e.query.minPrice>"u"?void 0:Number(e.query.minPrice),maxPrice:typeof e.query.maxPrice>"u"?void 0:Number(e.query.maxPrice)})),i=P(()=>({sorting:e.query.sorting||""})),t=P(()=>{const l=Number(e.query.page),f={page:l};return c.value&&l>c.value&&(f.page=c.value),l<1&&(f.page=1),f}),_=P(()=>({...o.value,...i.value,...t.value}));function a(l){return Array.isArray(l)?l:l==null?[]:[l.toString()]}return{getFilter:o,getSorting:i,getPage:t,getAllCatalogQueries:_,pageAmount:c}}const je={class:"filter"},De={class:"filter__inner"},Ge={class:"filter__form-inner"},Me={class:"filter__price-box"},Qe=S({__name:"CatalogFilter",props:{colors:{type:Array,required:!0},sizes:{type:Array,required:!0},brands:{type:Array,required:!0},isOverlayDisabled:{type:Boolean,default:!1}},setup(e){const p=O(),c=D(),o=j(),{getAllCatalogQueries:i}=Q(),t=h({colorId:[],sizeId:[],brandId:[],minPrice:0,maxPrice:0,page:1});function _(){t.value={colorId:[],sizeId:[],brandId:[],minPrice:void 0,maxPrice:void 0,page:1},a(t.value)}function a(b){c.replace({query:{...p.query,...b}}),f()}function l(){const b={};Object.keys(t.value).forEach(r=>{const n=t.value[r];(Array.isArray(n)||typeof n=="number"&&n>0||n===void 0)&&(b[r]=n),n===0&&(b[r]=void 0)});const s={...b,page:1};a(s)}function f(){Number(document.body.offsetWidth)>1024||o.toggleFilter()}function C(){t.value=i.value}return C(),E(()=>p.query,()=>{C()}),(b,s)=>(u(),x(_e,{onClose:f,disabled:e.isOverlayDisabled},{default:k(()=>[d("div",je,[d("div",De,[g(X,{class:"filter__btn-close","aria-label":"Закрыть фильтр товаров",onClick:N(f,["prevent"])}),d("form",{class:"filter__form",onSubmit:N(l,["prevent"])},[d("div",Ge,[s[5]||(s[5]=d("h2",{class:"filter__title"},"Фильтр",-1)),e.brands.length?(u(),x(G,{key:0,class:"filter__brand",legend:"Бренд"},{default:k(()=>[g(M,{modelValue:t.value.brandId,"onUpdate:modelValue":s[0]||(s[0]=r=>t.value.brandId=r),properties:e.brands},null,8,["modelValue","properties"])]),_:1})):$("",!0),e.sizes.length?(u(),x(G,{key:1,class:"filter__size",legend:"Размер"},{default:k(()=>[g(M,{modelValue:t.value.sizeId,"onUpdate:modelValue":s[1]||(s[1]=r=>t.value.sizeId=r),properties:e.sizes},null,8,["modelValue","properties"])]),_:1})):$("",!0),e.colors.length?(u(),x(G,{key:2,class:"filter__color",legend:"Цвет"},{default:k(()=>[g(M,{modelValue:t.value.colorId,"onUpdate:modelValue":s[2]||(s[2]=r=>t.value.colorId=r),properties:e.colors},null,8,["modelValue","properties"])]),_:1})):$("",!0),d("div",Me,[g(K,{modelValue:t.value.minPrice,"onUpdate:modelValue":s[3]||(s[3]=r=>t.value.minPrice=r),"input-type":"currency",label:"Цена от"},null,8,["modelValue"]),g(K,{modelValue:t.value.maxPrice,"onUpdate:modelValue":s[4]||(s[4]=r=>t.value.maxPrice=r),"input-type":"currency",label:"Цена до"},null,8,["modelValue"])]),g(J,{type:"submit",class:"filter__btn-submit","btn-name":"Применить",onClick:N(l,["prevent"])}),g(pe,{class:"filter__btn-reset","btn-name":"Сбросить",onClick:N(_,["prevent"])})])],32)])])]),_:1},8,["disabled"]))}}),Ke=I(Qe,[["__scopeId","data-v-d5b74080"]]),He={class:"catalog-counter"},Je=S({__name:"CatalogCounter",props:{amount:{type:Number,required:!0}},setup(e){return(p,c)=>(u(),v("div",He,[c[0]||(c[0]=w(" найдено ")),d("b",null,V(e.amount),1),c[1]||(c[1]=w(" шт. "))]))}}),Xe=I(Je,[["__scopeId","data-v-3885d4e7"]]),Ye={class:"pagination"},Ze={class:"pagination__inner"},et=["disabled"],tt={class:"pagination__list-btn"},lt=["onClick"],at=["disabled"],st=S({__name:"AppPagination",props:{totalPages:{type:Number,required:!0}},setup(e){const p=e,c=O(),o=D(),i=h(1);function t(a){a>=1&&a<=p.totalPages&&(i.value=a,_(a))}function _(a){o.push({query:{...c.query,page:a}})}return E(()=>c.query.page,a=>{const l=Number(a);Number.isNaN(l)||(l<=0?i.value=1:l>p.totalPages?i.value=p.totalPages:i.value=l)},{immediate:!0}),(a,l)=>(u(),v("div",Ye,[d("div",Ze,[d("button",{class:"pagination__btn pagination__btn-control pagination__btn--left",onClick:l[0]||(l[0]=f=>t(i.value-1)),disabled:i.value===1}," ◄ ",8,et),d("ul",tt,[(u(!0),v(L,null,T(e.totalPages,f=>(u(),v("li",{key:f,class:"pagination__item"},[d("button",{class:U(["pagination__btn pagination__btn-page",{checked:i.value===f}]),onClick:C=>t(f)},V(f),11,lt)]))),128))]),d("button",{class:"pagination__btn pagination__btn-control pagination__btn--right",onClick:l[1]||(l[1]=f=>t(i.value+1)),disabled:i.value===e.totalPages}," ► ",8,at)])]))}}),ot=I(st,[["__scopeId","data-v-99780824"]]),rt=["onClick","onKeypress"],it=S({__name:"AppSelect",props:{properties:{type:Array,required:!0},selectedId:{type:String,required:!0},placeholder:{type:String,default:"Выберите опцию"}},emits:["select"],setup(e,{emit:p}){const c=p,o=e,i=h(null),t=h(null),_=h(null),a=h(null),l=h(""),f=h(!1);function C(m){l.value=m.label,c("select",m.id),r()}function b(m){const z=o.properties.find(F=>F.id===m);z&&(l.value=z.label)}E(()=>o.selectedId,m=>{b(m)});function s(){t.value&&_.value&&(t.value.style.minWidth=`${_.value.offsetWidth}px`),_.value&&t.value&&(_.value.style.top=`${t.value.offsetHeight}px`),_.value&&t.value&&(_.value.style.minWidth=t.value.style.minWidth)}function r(){_.value&&(_.value.style.height="0"),f.value=!1,a.value&&a.value.querySelectorAll("li").forEach(m=>{m.removeAttribute("tabindex")})}function n(){if(_.value&&a.value&&(_.value.style.height=`${a.value.offsetHeight}px`),f.value=!0,a.value&&a.value.querySelectorAll("li").forEach(m=>{m.setAttribute("tabindex","0")}),a.value){const m=a.value.querySelector("li");m&&m.focus()}s()}function y(){f.value?r():n()}function A(m){i.value&&!i.value.contains(m.target)&&r()}function q(m){m.code==="Escape"&&r()}function B(){if(o.selectedId){const m=o.properties.find(z=>z.id===o.selectedId);m?l.value=m.label:l.value=o.placeholder}}return fe(()=>{s(),B(),window.addEventListener("click",A),window.addEventListener("keydown",q)}),ge(()=>{window.removeEventListener("click",A),window.removeEventListener("keydown",q)}),(m,z)=>(u(),v("div",{ref_key:"selectEl",ref:i,class:U(["select",{"select--open":f.value}])},[d("div",{ref_key:"placeholderEl",ref:t,class:"select__placeholder",tabindex:"0",onClick:y,onKeypress:H(y,["enter"])},[w(V(l.value||e.placeholder)+" ",1),z[0]||(z[0]=d("span",{class:"select__triangle"},null,-1))],544),d("div",{ref_key:"listWrapperEl",ref:_,class:"select__list-wrapper"},[d("ul",{ref_key:"listEl",ref:a,class:"select__list"},[(u(!0),v(L,null,T(e.properties,(F,ee)=>(u(),v("li",{key:ee,class:U(["select__item",{"select__item--selected":e.selectedId===F.id}]),onClick:te=>C(F),onKeypress:H(te=>C(F),["enter"])},V(F.label),43,rt))),128))],512)],512)],2))}}),nt=I(it,[["__scopeId","data-v-dd6abd0b"]]),ct={class:"applied-filters__list"},ut=S({__name:"CatalogAppliedFilters",setup(e){const{brands:p,colors:c,sizes:o}=ve(Y()),{getFilter:i}=Q(),t=O(),_=D();function a(s){return Array.isArray(s)?s.map(r=>r.toString()):s?[s.toString()]:[]}function l(s,r){const n=h([]);r==="brandId"?n.value=p.value:r==="sizeId"?n.value=o.value:r==="colorId"&&(n.value=c.value);const y=n.value.find(A=>A._id===s);if(y)return{_id:y._id,name:y.name,queryName:r}}function f(){const s=[];return Object.entries(i.value).forEach(([r,n])=>{if(r==="minPrice"||r==="maxPrice"){if(n){const y={minPrice:`Цена от ${n}`,maxPrice:`Цена до ${n}`};s.push({_id:r,name:y[r],queryName:r})}}else a(n).forEach(y=>{const A=l(y,r);A&&s.push(A)})}),s}const C=P(()=>f());function b(s,r){const n={...i.value};if(s in n)if(s==="minPrice"||s==="maxPrice")n[s]=void 0;else if(Array.isArray(n[s])){const y=n[s];n[s]=y.filter(A=>A!==r)}else n[s]=[];_.replace({query:{...t.query,...n}})}return(s,r)=>(u(),v("div",{class:U(["applied-filters",{"applied-filters--empty":!C.value.length}])},[d("ul",ct,[(u(!0),v(L,null,T(C.value,(n,y)=>(u(),v("li",{class:"applied-filters__item",key:y},[g(X,{bordered:!0,name:n.name,onClick:A=>b(n.queryName,n._id)},null,8,["name","onClick"])]))),128))])],2))}}),dt=I(ut,[["__scopeId","data-v-cd1b1acb"]]),pt={class:"catalog-page"},_t={key:0,class:"catalog-page__aside"},ft={class:"catalog-page__counter-box"},gt={class:"catalog-page__applied-filters-box"},vt={class:"catalog-page__main"},mt={class:"catalog-page__sec"},bt=S({__name:"CatalogPage",setup(e){const p=O(),c=D(),o=Y(),i=Z(),t=j(),{getAllCatalogQueries:_}=Q(),a=h(""),l=[{label:"По релевантности",id:""},{label:"Цена по возрастанию",id:"priceUp"},{label:"Цена по убыванию",id:"priceDown"}],f=P(()=>t.screenWidth>1024||t.screenWidth<=1024&&!t.isfilterOpen),C=P(()=>t.screenWidth>1024?!0:!!(t.screenWidth<=1024&&t.isfilterOpen)),b=P(()=>i.config),s=P(()=>b.value&&"totalProducts"in b.value?b.value.totalProducts:0),r=P(()=>!o.isColorsLoading&&!o.isSizesLoading&&!o.isBrandsLoading),n=P(()=>!i.isLoading),y=P(()=>b.value&&"totalPages"in b.value?b.value.totalPages:0);i.fetchCatalog(_.value);function A(q){a.value=q}return E(()=>p.query,()=>{i.fetchCatalog(_.value)}),E(()=>a.value,()=>{const q=a.value?a.value:void 0;c.replace({query:{...p.query,sorting:q}})}),(q,B)=>(u(),v("div",pt,[g(me,{class:"catalog-page__container"},{default:k(()=>[g(ye,{class:"catalog-page__title"},{default:k(()=>B[0]||(B[0]=[w(" Mountain bikes ")])),_:1}),g(W,{name:"appear-left"},{default:k(()=>[r.value?(u(),v("aside",_t,[(u(),x(be,{to:"body",disabled:f.value},[g(W,{name:"appear"},{default:k(()=>[C.value?(u(),x(Ke,{key:0,class:"catalog-page__filter","is-overlay-disabled":f.value,colors:R(o).colors,sizes:R(o).sizes,brands:R(o).brands},null,8,["is-overlay-disabled","colors","sizes","brands"])):$("",!0)]),_:1})],8,["disabled"]))])):$("",!0)]),_:1}),g(W,{name:"appear-top"},{default:k(()=>[r.value&&s.value?(u(),x(nt,{key:0,class:"catalog-page__select",placeholder:"Сортировка",properties:l,"selected-id":a.value,onSelect:A},null,8,["selected-id"])):$("",!0)]),_:1}),d("div",ft,[g(W,{name:"appear"},{default:k(()=>[n.value?(u(),x(Xe,{key:0,amount:s.value},null,8,["amount"])):$("",!0)]),_:1})]),d("div",gt,[g(dt)]),d("main",vt,[d("section",mt,[n.value?(u(),x(Oe,{key:0,class:"catalog-page__list",catalog:R(i).catalog},null,8,["catalog"])):$("",!0)])]),y.value>1&&n.value?(u(),x(ot,{key:0,class:"catalog-page__pagination","total-pages":y.value},null,8,["total-pages"])):$("",!0)]),_:1})]))}}),At=I(bt,[["__scopeId","data-v-557bcf2b"]]);export{At as default};
